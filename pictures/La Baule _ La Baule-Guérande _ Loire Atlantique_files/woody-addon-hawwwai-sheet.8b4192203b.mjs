(function($,window,document){window.rcJsVersion=window.rcJsVersion||{},rcJsVersion.sheetBundle="0.0.4",window.rcModule=window.rcModule||{};function isJSDebugMode(){const e=new URLSearchParams(window.location.search);return e.has("jsdebug")&&e.get("jsdebug")==="true"}function setInnerHTML(e,t){e.innerHTML=t,Array.from(e.querySelectorAll("script")).forEach(n=>{const s=document.createElement("script");Array.from(n.attributes).forEach(r=>{s.setAttribute(r.name,r.value)});const o=document.createTextNode(n.innerHTML);s.appendChild(o),n.parentNode.replaceChild(s,n)})}function setInnerHTMLv2(id,html){var ele=document.getElementById(id);ele.innerHTML=html;for(var codes=ele.getElementsByTagName("script"),i=0;i<codes.length;i++)eval(codes[i].text)}function getTranslation(e){return __hw?__hw[e]:e}var show=function(e){e.classList.remove("hide")},hide=function(e){e.classList.add("hide")};function fakeClick(e){e.addEventListener("keydown",t=>{(t.key.toLowerCase()=="enter"||t.key.toLowerCase()==" ")&&(t.preventDefault(),e.click())})}Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},rcModule.datesStorageService=rcModule.datesStorageService||function(){var e={},t=[],n=!!window.sessionStorage;return e.set=function(s,o){var r={date:moment().format(),data:s};t.push(r),(n||o)&&sessionStorage.setItem("dates_global",JSON.stringify(t))},e.get=function(){if(n){t=[];var s=sessionStorage.getItem("dates_global");try{t=s?JSON.parse(s):[]}catch{}}var o=t[t.length-1];return o&&o.data?moment(o.data.start).isBefore(moment().startOf("day"))?(e.remove(),null):o.data:null},e.remove=function(){t=[];var s={date:moment().format(),data:!1};t.push(s),n&&sessionStorage.setItem("dates_global",JSON.stringify(t))},e}();function xorDecrypt(e,t){const n=atob(e);let s="";for(let o=0;o<n.length;o++)s+=String.fromCharCode(n.charCodeAt(o)^t.charCodeAt(o%t.length));return s}function decryptToken(e){try{const n=atob(e).split(":");if(n.length!==3||n.some(d=>d===""))throw new Error("Format de token invalide.");const[s,o,r]=n,l=xorDecrypt(o,s),u=xorDecrypt(r,s);return{login:l,password:u}}catch(t){return console.error("Erreur de d\xE9cryptage :",t.message),null}}const proxyApi=location.origin+"/api",ajaxHeaders=new Headers,credentials=decryptToken(window.siteConfig.token);ajaxHeaders.set("Authorization","Basic "+btoa(credentials?.login+":"+credentials?.password));async function postData(e="",t={}){return await fetch(proxyApi+e,{method:"POST",mode:"same-origin",credentials:"include",headers:ajaxHeaders,body:JSON.stringify(t)})}moment.updateLocale(globals.current_locale,{week:{dow:1}});const now=moment(),tr={today:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.TODAY"),happening:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.HAPPENING"),ended:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.ENDED"),endedForToday:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.ENDED_FOR_TODAY"),fromToday:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.FROM_TODAY"),from:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.FROM"),untilToday:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.UNTIL_TODAY"),to:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.TO"),until:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.UNTIL"),untilLong:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.UNTIL_LONG"),on:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.ON"),opened:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.OPENED"),closed:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.CLOSED"),closedForToday:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.CLOSEDFORTODAY"),untilTime:getTranslation("GLOBAL.TIMES.TO"),undefined:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.UNDEFINED"),now:getTranslation("SECTIONS.TOURISM.SHEET.PERIODS.NOW")},globalDescriptionComponent=document.querySelector(".woody-component-sheet-global-description");if(globalDescriptionComponent!==null){const e=globalDescriptionComponent.querySelector(".sheet-global-description .description"),t=globalDescriptionComponent.querySelector(".sheet-global-description .practical"),n=document.getElementById("open-full-description");if(e&&n){const s=e.innerHTML,o=ellipsis(s,300);o===s?(n.style.display="none",t&&(t.style.display="block")):(n.style.display="inline-flex",e.innerHTML=o,t&&(t.style.display="none"),n.addEventListener("click",()=>{e.innerHTML=s,t&&(t.style.display="block"),n.style.display="none"}))}}function ellipsis(e,t=100,n="...",s=!1,o=!0){if(typeof n=="object"&&n!==null&&({length:t=100,ending:n="...",exact:s=!1,considerHtml:o=!0}=n),!o){if(e.length<=t)return e;let c=e.slice(0,t-n.length);if(!s){const m=c.lastIndexOf(" ");m!==-1&&(c=c.slice(0,m))}return c+n}const r=document.createElement("div");r.innerHTML=e;const l=[];let u="",d=0;function h(c){if(!(d>=t)){if(c.nodeType===Node.TEXT_NODE){const m=c.textContent.replace(/\s+/g," "),S=t-d;if(m.length+d>t){let v=m.slice(0,S);if(!s){const A=v.lastIndexOf(" ");A!==-1&&(v=v.slice(0,A))}u+=v+n,d=t}else u+=m,d+=m.length}else if(c.nodeType===Node.ELEMENT_NODE){const m=c.nodeName.toLowerCase(),S=["area","base","br","col","command","embed","hr","img","input","link","meta","param","source","track","wbr"];if(u+=`<${m}${Array.from(c.attributes).map(v=>` ${v.name}="${v.value}"`).join("")}>`,!S.includes(m)){l.push(m);for(let v of c.childNodes)if(h(v),d>=t)break;u+=`</${l.pop()}>`}}}}for(let c of r.childNodes){if(d>=t)break;h(c)}for(;l.length;)u+=`</${l.pop()}>`;return u}const bookingDOMWrapperTag=document.querySelector(".woody-component-sheet-booking"),bookingDOMBindingTag=document.querySelector("#booking-binding");function updateEllohaBookingLink(){var e=rcModule.datesStorageService.get();if(e)for(var t=[".sheet-centralResa > a"],n=document.querySelectorAll(t),s=0;s<n.length;s++){var o=new URL(n[s].href);if(!o.pathname.includes("/Search/Index"))return;if(e.persons&&e.persons.adults&&o.searchParams.set("NbAdultes",e.persons.adults),e.persons&&e.persons.children){var r=e.childrenData;o.searchParams.set("NbEnfants",e.persons.children),r&&o.searchParams.set("AgeEnfants",r.map(function(u){return u.age}).join("_"))}if(e.start&&e.end){var l="DD/MM/YYYY";o.searchParams.delete("searchFirstAvailableDates"),o.searchParams.set("dateFrom",moment(e.start).format(l)),o.searchParams.set("duration",Math.max(1,moment(e.end).diff(moment(e.start),"days")))}n[s].href=o.toString()}}updateEllohaBookingLink();function isHostingSheet(){return HwSheet?["HOT","HLO","HPA","VIL"].indexOf(HwSheet.bordereau)!==-1:!0}async function getAvailabilities(){var e=rcModule.datesStorageService.get();let t=moment().format("YYYY-MM-DD");HwSheet&&HwSheet.centralResa&&(HwSheet.centralResa.type==="99.20.02.02.16"&&(t=null),HwSheet.centralResa.type==="99.20.02.02.05"&&HwSheet.centralResa.identifier.includes("OPBI-")&&(t=null));let n={startDate:e?.start?moment(e.start).format("YYYY-MM-DD"):t,endDate:e?.end?moment(e.end).format("YYYY-MM-DD"):t,persons:e?.persons?e.persons:{adults:1,children:0}};return n.lang=hwConfig.lang,n.appType="website",isHostingSheet()&&moment(n.startDate).format("L")===moment(n.endDate).format("L")&&(n.endDate=moment(n.endDate).add(1,"days")),(await postData("/content/ts/"+hwConfig.accountName+"/sheets/"+globals.sheet_id+"/availabilities/search",n)).json()}bookingDOMBindingTag&&getAvailabilities().then(e=>{e.data.widgetUrl&&fetch(e.data.widgetUrl,{headers:ajaxHeaders}).then(t=>t.text()).then(function(t){show(bookingDOMWrapperTag),setInnerHTML(bookingDOMBindingTag,t)})}),document.querySelectorAll("div[dynamic-openings]").forEach(e=>dynamicOpenings(e));function dynamicOpenings(e){var t=moment(now).format("L"),n=moment.duration(now.format("HH:mm")),s,o,r=!1,l=!1,u=!1,d=!1,h,c;try{var h=JSON.parse(e.getAttribute("periods"))}catch(a){console.error("dynamicOpenings parsing",a)}var m=$(e.firstElementChild),S=m.children(".opening-state--text"),v=m.children(".opening-time"),A=$(e).children(".opening-extra-info"),_=$(e).children(".opening-unguaranteed"),D=$(e);e.getAttribute("interpolate")&&(u=!0),e.getAttribute("guessclosed")&&(d=!0),c=e.getAttribute("bordereau")||"UND";var L=tr.opened+" "+tr.today.toLowerCase(),w=tr.closed+" "+tr.today.toLowerCase(),M=tr.closedForToday;window.globals.current_locale==="de"&&(L=tr.today+" "+tr.opened,L=+tr.opened),["ASC","FMA"].includes(c)&&(L=tr.happening+" "+tr.today.toLowerCase()),["FMA"].includes(c)&&(w=M=tr.endedForToday);var Y=tr.closed,N=tr.undefined,R=!1,I=function(){m.removeClass("opening-state-undefined"),m.removeClass("opening-state-soon"),m.removeClass("opening-state-closed"),m.removeClass("opening-state-opened")},q=function(a){I(),["undefined","soon","closed","opened"].includes(a)&&m.addClass("opening-state-"+a)},O=function(a){isJSDebugMode()&&console.warn("setToClose"),q("closed"),_.hide(),v.remove(),S.html(a?M:w)},B=function(){isJSDebugMode()&&console.warn("setToUndefined"),q("undefined"),S.html(N)},F=function(a,x,b,f){isJSDebugMode()&&console.warn("setPartial"),f=typeof f<"u"?f:!1,isJSDebugMode()&&console.info("type of main_info :"+typeof f),RcThesaurus.getResult(b,$rootScope.currentLanguage.substring(0,2)).then(function(p){x==="closed"?f?S.html(Y+" "+(a.on+" "+p).toLowerCase()):(A.html(Y+" "+(a.on+" "+p).toLowerCase()),A.show()):x==="opened"?f?S.html(L+" "+a.on+" "+p):(A.html(L+" "+a.on+" "+p),A.show()):console.error("bad state parameter"),q("soon")})},k=function(a){if(isJSDebugMode()&&console.warn("setToOpen",a),q("opened"),S.html(L),_.hide(),R){var x=j();x.forEach(function(C){C.format("L")===now.format("L")&&_.show()})}if(a&&a.length){var b=!1,f=!1,p=-1,g,y;for(let C=0;C<a.length;C++){let H=a[C];H.startTime&&H.endTime&&(s=H.startTime,o=H.endTime,G(s,o)&&(b=!0))}if(a.length===2&&a[0].startTime&&a[1].endTime&&!a[0].endTime&&(s=a[0].startTime,o=a[1].endTime,G(s,o)&&(b=!0)),a.length===1&&a[0].startTime&&!a[0].endTime&&(s=a[0].startTime,g=moment.duration(s),y=n-g,y>0&&(f=!0,p=0)),b){var E;if(a[0].endTime&&U(a[0].endTime,a[0].startTime)>0?E=a[0].endTime:a.length>1&&a[1].endTime&&(a[1].startTime&&a[1].endTime&&U(a[1].endTime,a[1].startTime)>0||!a[1].startTime&&a[0].startTime&&a[1].endTime&&U(a[1].endTime,a[0].startTime)>0)&&(E=a[1].endTime),E){var T=E.split(":"),J=T[0],W=T[1],z=moment(new Date(now.year(),now.month(),now.day(),J,W,"00")).format("LT");v.html(tr.untilTime+" "+z)}}else if(f)isJSDebugMode()&&console.warn("isHappeningStartOnly",p),a[p].startTime&&U(a[p].startTime)>0?(v.html(U(a[0].startTime).humanize(!0)),q("soon")):v.html(tr.now);else{v.html(tr.now);for(let C=0;C<a.length;C++){let H=a[C];if(H.startTime&&U(H.startTime)>0)return v.html(U(H.startTime).humanize(!0)),q("soon")}O(!0)}}else R&&now.isoWeekday()===7&&(isJSDebugMode()&&console.info("dO unguaranteed: dimanche"),_.show())},G=function(a,x){var b=!1,f=x;f==="00:00:00"&&(f="24:00:00");var p=moment.duration(a),g=moment.duration(f);g<p&&g.add("24:00:00");var y=n-p,E=g-n;return y>0&&E>0&&(b=!0),b},U=function(a,x){var b=a;if(b=moment.duration(b),typeof x<"u"){var f=moment.duration(x);b<f&&b.add("24:00:00")}var p=b-n,g=moment.duration(p);return g},j=function(){var a=now.year(),x=a%19,b=Math.floor(a/100),f=(b-Math.floor(b/4)-Math.floor((8*b+13)/25)+19*x+15)%30,p=f-Math.floor(f/28)*(1-Math.floor(f/28)*Math.floor(29/(f+1))*Math.floor((21-x)/11)),g=(a*1+Math.floor(a/4)+p+2-b+Math.floor(b/4))%7,y=p-g,E=3+Math.floor((y+40)/44),T=y+28-31*Math.floor(E/4),J=moment(new Date(a,"00","01")),W=moment(new Date(a,"04","01")),z=moment(new Date(a,"04","08")),C=moment(new Date(a,"06","14")),H=moment(new Date(a,"07","15")),V=moment(new Date(a,"10","01")),P=moment(new Date(a,"10","11")),K=moment(new Date(a,"11","25")),Q=moment(new Date(a,"11","26")),X=moment(new Date(a,E-1,T)),Z=moment(new Date(a,E-1,T+1)),ee=moment(new Date(a,E-1,T+39)),te=moment(new Date(a,E-1,T+49)),ne=moment(new Date(a,E-1,T+50));return new Array(J,X,Z,W,z,ee,te,ne,C,H,V,P,K,Q)};u&&d?(m.removeClass("opening-state-undefined"),m.addClass("opening-state-closed"),S.html(w)):(m.addClass("opening-state-undefined"),S.html(N)),h.forEach(function(a,x){R=!1;var b=!1;if(x+1===h.length&&(b=!0),a._isMultipleOneDays){if(isJSDebugMode()&&console.info("_isMultipleOneDays"),(moment(a.startDate).isBefore(now)||moment(a.startDate).format("L")===t)&&(moment(a.endDate).isAfter(now)||moment(a.endDate).format("L")===t)&&a._multipleDay.code){switch(l=!1,now.isoWeekday()){case 1:a._multipleDay.code==="09.02.02"&&(l=!0);break;case 2:a._multipleDay.code==="09.02.03"&&(l=!0);break;case 3:a._multipleDay.code==="09.02.04"&&(l=!0);break;case 4:a._multipleDay.code==="09.02.05"&&(l=!0);break;case 5:a._multipleDay.code==="09.02.06"&&(l=!0);break;case 6:a._multipleDay.code==="09.02.07"&&(l=!0);break;case 7:a._multipleDay.code==="09.02.01"&&(l=!0);break}l?(r=!0,a._formated_days&&a._formated_days[0].schedules?k(a._formated_days[0].schedules):k([]),D.show()):(r=!0,O(),c!=="FMA"&&D.show())}}else if(a._isOneDay)isJSDebugMode()&&console.info("_isOneDay"),moment(a.startDate).format("L")===t&&moment(a.endDate).format("L")===t?(r=!0,a._formated_days?k(a._formated_days[0].schedules):k([]),D.show()):(r=!0,b&&moment(a.startDate).isBefore(now)&&(O(),D.show()));else if((moment(a.startDate).isBefore(now)||moment(a.startDate).format("L")===t)&&(moment(a.endDate).isAfter(now)||moment(a.endDate).format("L")===t))if(a._isAllYear&&(R=!0),a._formated_days){l=!1;var f=!1,p=!1,g,y;a._onlyClosedHours&&(l=!0,p=!0),a._formated_days.forEach(function(E,T){switch(E.day){case"09.02.02":moment(now).isoWeekday()===1&&(l=!0,p=!0,g=T);break;case"09.02.03":moment(now).isoWeekday()===2&&(l=!0,p=!0,g=T);break;case"09.02.04":moment(now).isoWeekday()===3&&(l=!0,p=!0,g=T);break;case"09.02.05":moment(now).isoWeekday()===4&&(l=!0,p=!0,g=T);break;case"09.02.06":moment(now).isoWeekday()===5&&(l=!0,p=!0,g=T);break;case"09.02.07":moment(now).isoWeekday()===6&&(l=!0,p=!0,g=T);break;case"09.02.01":moment(now).isoWeekday()===7&&(l=!0,p=!0,g=T);break;case"184.09.02.01":case"184.09.02.02":case"184.09.02.03":case"184.09.02.04":moment(now).isoWeekday()===1&&(l=!0,f=!0,y=T);break;case"184.09.02.05":case"184.09.02.06":case"184.09.02.07":case"184.09.02.08":moment(now).isoWeekday()===2&&(l=!0,f=!0,y=T);break;case"184.09.02.09":case"184.09.02.10":case"184.09.02.11":case"184.09.02.12":moment(now).isoWeekday()===3&&(l=!0,f=!0,y=T);break;case"184.09.02.13":case"184.09.02.14":case"184.09.02.15":case"184.09.02.16":moment(now).isoWeekday()===4&&(l=!0,f=!0,y=T);break;case"184.09.02.17":case"184.09.02.18":case"184.09.02.19":case"184.09.02.20":moment(now).isoWeekday()===5&&(l=!0,f=!0,y=T);break;case"184.09.02.21":case"184.09.02.22":case"184.09.02.23":case"184.09.02.24":moment(now).isoWeekday()===6&&(l=!0,f=!0,y=T);break;case"184.09.02.25":case"184.09.02.26":case"184.09.02.27":case"184.09.02.28":moment(now).isoWeekday()===7&&(l=!0,f=!0,y=T);break}}),l?(r=!0,isJSDebugMode()&&console.warn("# isToday (fullday:"+p+") (partialday:"+f+")","setToOpen([]) by default"),k([]),p&&f?g!==void 0&&a._formated_days[g]&&a._formated_days[g].schedules&&a._formated_days[y].closure?(k(a._formated_days[g].schedules),F(tr,"closed",a._formated_days[y].day)):g!==void 0&&a._formated_days[g]&&a._formated_days[g].closure&&a._formated_days[y].schedules&&(O(),F(tr,"opened",a._formated_days[y].day)):p&&!f?g!==void 0&&a._formated_days[g]&&a._formated_days[g].closure?O():g!==void 0&&a._formated_days[g]&&a._formated_days[g].schedules&&k(a._formated_days[g].schedules):f&&!p&&(y&&a._formated_days[y]&&a._formated_days[y].closure?F(tr,"closed",a._formated_days[y].day,!0):y&&a._formated_days[y]&&a._formated_days[y].schedules&&F(tr,"opened",a._formated_days[y].day,!0)),D.show()):u&&(isJSDebugMode()&&console.info("show default (interpolate true"),D.show())}else isJSDebugMode()&&console.info("no hours defined"),r=!0,k([]),D.show();r||u&&(d?O():B())}),u&&D.show()}const openingPeriodsContainer=document.querySelector("[event-ended][periods]"),endedEventSection=document.querySelector(".over-event-label");var isEventEnded=!0;if(openingPeriodsContainer!==null){let e=openingPeriodsContainer.hasAttribute("periods")?openingPeriodsContainer.getAttribute("periods"):"";if(e=JSON.parse(e),e&&Array.isArray(e)&&e.forEach(t=>{moment(t.endDate).isAfter(now)&&(isEventEnded=!1)}),isEventEnded){const t=document.querySelectorAll(".dynamic-opening-periods, .sheet-sidebar-item-event");t.length&&t.forEach(n=>{n.remove()}),endedEventSection!==null&&show(endedEventSection)}else endedEventSection!==null&&endedEventSection.remove()}const periodParsers=document.querySelectorAll("[period-parser]");periodParsers.length>0&&periodParsers.forEach(e=>{if(e.hasAttribute("start")){if(e.hasAttribute("start")&&e.hasAttribute("multiple")&&moment(e.getAttribute("start")).isBefore(now)&&moment(e.getAttribute("end")).isAfter(now)){let t=e.getAttribute("start");for(;moment(t).isBefore(now)&&moment(t).format("L")!==moment(now).format("L");)t=moment(t).add(7,"days");e.querySelector(".start-date")!==null&&(e.querySelector(".start-date").innerHTML=t.format("LL"));let n="";e.querySelector(".opening-hours")&&(n=e.querySelector(".opening-hours").innerHTML);let s=e.querySelector(".prefix-text-start");if(s!==null)if(moment(t).format("L")===moment(now).format("L")&&moment(t).format("L")!==moment(e.getAttribute("end")).format("L")){let o=e.querySelector(".prefix-text-start")!==null?e.querySelector(".prefix-text-start").innerHTML:"",r=tr.today.charAt(0).toUpperCase()+tr.today.slice(1);s.innerHTML=r+" "+n+"<br />"+o,e.querySelector(".start-date")!==null&&(e.querySelector(".start-date").innerHTML=moment(t).add(7,"days").format("LL")),moment(t).add(7,"days").format("L")===moment(e.getAttribute("end")).format("L")&&(s.innerHTML=r+" "+n+"<br />"+tr.on+" "+moment(t).format("dddd"),e.querySelector(".end-date")!==null&&e.querySelector(".end-date").remove(),e.querySelector(".prefix-text-end")!==null&&e.querySelector(".prefix-text-end").remove())}else if(moment(t).format("L")===moment(now).format("L")){let o=tr.today.charAt(0).toUpperCase()+tr.today.slice(1);s.innerHTML=o+" "+n,e.querySelector(".start-date")!==null&&e.querySelector(".start-date").remove(),e.querySelector(".end-date")!==null&&e.querySelector(".end-date").remove(),e.querySelector(".prefix-text-end")!==null&&e.querySelector(".prefix-text-end").remove(),moment(t).format("L")===moment(e.getAttribute("end")).format("L")&&e.querySelector(".opening-hours")!==null&&e.querySelector(".opening-hours").remove()}else moment(t).format("L")===moment($attrs.end).format("L")?(s.innerHTML=tr.on+" "+moment(t).format("dddd"),e.querySelector(".end-date")!==null&&e.querySelector(".end-date").remove(),e.querySelector(".prefix-text-end")!==null&&e.querySelector(".prefix-text-end").remove()):(moment($attrs.start).format("L"),moment($attrs.end).format("L"))}if(e.hasAttribute("start")&&e.hasAttribute("end")){if(moment(e.getAttribute("end")).isBefore(now)&&moment(e.getAttribute("end")).format("L")!==moment(now).format("L")){if(e.hasAttribute("type")&&e.getAttribute("type")=="tab"){let t=e.closest("ul").querySelector("li.is-active"),n=t!==null?t.querySelector("a").getAttribute("href"):"",s=t!==null&&n!==null?t.closest(".woody-component-tabs").querySelector(`.tabs-content ${n}`):"";if(t.classList.add("is-minor"),t!==null&&s!==null){let o=t.nextElementSibling;if(o!==null){t.classList.remove("is-active"),s.classList.remove("is-active"),o.classList.add("is-active");let r=o.querySelector("a").getAttribute("href");r!==null&&t.closest(".woody-component-tabs").querySelector(`.tabs-content ${r}`).classList.add("is-active")}}}}else if(moment(e.getAttribute("start")).isBefore(now)&&!e.hasAttribute("multiple")&&!e.hasAttribute("oneday")){let t=e.querySelector(".prefix-text-end");e.querySelector(".start-date")!==null&&e.querySelector(".start-date").remove(),e.querySelector(".prefix-text-start")!==null&&e.querySelector(".prefix-text-start").remove(),e.querySelector("br")!==null&&e.querySelector("br").remove(),t!==null&&(moment(e.getAttribute("end")).format("L")===moment(now).format("L")?t.innerHTML=tr.today.charAt(0).toUpperCase()+tr.today.slice(1):t.innerHTML=tr.untilLong.charAt(0).toUpperCase()+tr.untilLong.slice(1))}else if(moment(e.getAttribute("start")).isBefore(now)&&e.hasAttribute("oneday")){let t=e.querySelector(".prefix-text-start");t!==null&&(moment(e.getAttribute("start")).format("L")===moment(now).format("L")?(t.innerHTML=tr.today.charAt(0).toUpperCase()+tr.today.slice(1),e.querySelector(".start-date")!==null&&e.querySelector(".start-date").remove()):t.innerHTML=tr.untilLong.charAt(0).toUpperCase()+tr.untilLong.slice(1))}}}});const phoneRevealButtons=document.querySelectorAll(".reveal-phone-button");phoneRevealButtons.length>0&&phoneRevealButtons.forEach(e=>{e.addEventListener("click",()=>{let t=e.nextElementSibling;t!==null&&t.classList.contains("reveal-phone")&&(t.classList.remove("hide"),e.remove())})});const sidebarItemEvent=document.querySelector(".sheet-sidebar-item-event");if(sidebarItemEvent!=null){let e=sidebarItemEvent.querySelectorAll(".date-item.date-oneday"),t=sidebarItemEvent.querySelectorAll(".date-item.date-multipleday");e.forEach(n=>{n.hasAttribute("date-start")&&moment(n.getAttribute("date-start")).isBefore(moment())&&moment(n.getAttribute("date-start")).format("L")!==moment().format("L")&&n.remove()}),t.forEach(n=>{n.hasAttribute("date-end")&&moment().isBefore(n.getAttribute("date-end"))||n.remove()})}const sheetForms=document.querySelectorAll("#sheetContactForm, #sheetReportIssueForm");sheetForms.length>0&&sheetForms.forEach(e=>{e.onsubmit=function(t){t.preventDefault();const n=new FormData(e),s=getHawwwaiConfig(e);let o={appType:"website",destination_id:s.destinationApiId};if(n.forEach((u,d)=>{o[d]=u}),o.hasOwnProperty("phone_code")){const u=o.phone_code;let d=o.phone;o.phone_no_code=d;const h=u.split("|");h?.length>0&&(o.phone=h[1]+" "+d)}let r=e.getAttribute("data-form-type"),l=getSummarySheetId(e);grecaptcha.enterprise.ready(function(){const u=(globals.site_key+"_"+l+"_sheet").replaceAll("-","_");grecaptcha.enterprise.execute("6LetxywmAAAAAKtAfAGDva__mzxqz91A0aYeC6Iu",{action:u}).then(function(d){let h=e.querySelector("#g-recaptcha");h!==null&&(h.value=d,submitForm(d,u,o,r,e,s,l))})})}});const dateInputs=document.querySelectorAll("#stayStartDate, #stayEndDate");dateInputs.length>0&&dateInputs.forEach(e=>{e.value=now?now.format("YYYY-MM-DD"):new Date().toISOString().slice(0,10),e.min=now?now.format("YYYY-MM-DD"):new Date().toISOString().slice(0,10)});function submitForm(e,t,n,s,o,r,l){if(e&&t&&n&&s&&o&&r&&l)switch(s){case"feedback":submitIssueReportForm(e,t,n,o,r);break;case"contact":submitContactForm(e,t,n,o,r,l);break}}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}async function submitIssueReportForm(e,t,n,s,o){const l=`/webforms/mailer/${o.services.feedback}/feedback`;n["g-recaptcha-response-ent"]=e,n.token=e,n.uniqueId=t,n.url=location.protocol+"//"+location.host+location.pathname;const u=await postData(l,n);validateForm(u,s)}async function submitContactForm(e,t,n,s,o,r){const u=`/webforms/mailer/${o.services.contact}/ts/sheets/${r}`,d=s.getAttribute("data-contact-code"),h=parseInt(s.getAttribute("data-contact-position")),c="/myaccount/events";n["g-recaptcha-response-ent"]=e,n.uniqueId=t,n.source="Woody",n.optinOT=!!n.optinOT,n.optinPresta=!!n.optinPresta,d&&h&&(n.to_code=d,n.to_position=h);const m=await postData(u,n),S=await postData(c,{uuid:uuid(),destination_id:o.destinationApiId,website_uid:btoa(globals.site_key),action:"add",date:new Date().toISOString().replace("Z","+02:00"),event_type:"CONTACT",object_type:"sheet",object_id:r,data:{type:"SHEET_CONTACT_WEBSITE_FORM",civility:n.civility,name:n.name,firstname:n.firstname,email:n.email,message:n.message,optin_ot:!!n.optinOT,optin_prestataire:!!n.optinPresta,stay_end_date:n.stayEndDate,stay_start_date:n.stayStartDate},fetcherType:"website_prod"});validateForm(m,s)}function validateForm(e,t){let n=t.querySelector(".success-message"),s=t.querySelector(".error-message"),o=t.querySelector(".sheet-submit-form");e.ok?(t.reset(),n!==null&&(n.classList.remove("hide"),o!==null&&eskalad(o))):s!==null&&s.classList.remove("hide")}function getHawwwaiConfig(e){let t={};if(globals&&globals.post_type=="touristic_sheet")t=hwConfig;else{let n=e.closest(".reveal");if(n!==null){let s=n.id,o=document.querySelector(`[data-open="${s}"]`);if(o!==null){let r=o.closest(".woody-component-sheet-summary");r!==null&&(t=r.hasAttribute("data-hw-config")?JSON.parse(r.getAttribute("data-hw-config")):null)}}}return t}function getSummarySheetId(e){let t="";if(globals&&globals.post_type=="touristic_sheet")t=globals.sheet_id;else{let n=e.closest(".reveal");if(n!==null){let s=n.id,o=document.querySelector(`[data-open="${s}"]`);if(o!==null){let r=o.closest(".woody-component-sheet-summary");r!==null&&(t=r.hasAttribute("data-sheet-summary-id")?r.getAttribute("data-sheet-summary-id"):"")}}}return t}$(".contact-form-reveal, .issue-report-form-reveal").on("open.zf.reveal",function(){const e="https://www.google.com/recaptcha/enterprise.js?render=6LetxywmAAAAAKtAfAGDva__mzxqz91A0aYeC6Iu";if(document.querySelector(`script[src="${e}"]`)==null){let t=document.createElement("script");t.src=e,document.body.append(t)}}),$(".contact-form-reveal, .issue-report-form-reveal").on("closed.zf.reveal",function(){const e=$(this);if(e.length){const t=e.find(".success-message"),n=e.find(".error-message");t.length&&t.addClass("hide"),n.length&&n.addClass("hide")}});function eskalad(e){let t,n;switch(globals.post_type){case"touristic_sheet":t="hawwwai_sheet_",n=globals.current_lang.toUpperCase()+"|FICHE|"+globals.post_title.trim()+"|"+globals.sheet_id;break;default:t="woody_page_",n=globals.current_lang.toUpperCase()+"|PAGE|"+globals.post_title.trim()+"|"+globals.post_id;break}if(e.dataset.event!==void 0){let s=e.dataset.name?e.dataset.name:"",o;e.dataset.label?o=e.dataset.label:e.getAttribute("href")?o=e.getAttribute("href"):o="",window.eskalad.pushEvent({event:t+e.dataset.event.toLowerCase(),ga4:{name:s,label:o},matomo:{category:n,action:s,name:o},at:{name:s+" - "+o,type:"action"}})}}document.querySelectorAll(".woody-component-sheet-availabilities .swiper-container").forEach(e=>{const t=parseInt(moment().month()),n=moment().year(),s=e.querySelectorAll(".swiper-slide");if(s)for(const o of s)for(;parseInt(o.dataset.month)<t&&parseInt(o.dataset.year)==n;){o.remove();break}});const hwSheetDealPart=document.querySelector(".woody-component-sheet-deals");if(hwSheetDealPart&&globals){fetch(`/wp-json/woody/hawwwai/sheet/deals/${globals.post_id}/${globals.current_locale}`).then(o=>o.json()).then(o=>{let r,l;for(let u in o)o[u].endDate&&o[u].startDate&&(r=moment(o[u].endDate).unix(),l=moment(o[u].startDate).unix(),e(l,r,u)),o[u].isShared==!0&&s(u,o[u])}).catch(o=>{console.log(o)});const e=(o,r,l)=>{let u=o<moment().unix()?moment().unix():o,d=r-u;if(d>0){let h=parseInt(d/86400),c=parseInt((d-86400*h)/3600),m=parseInt((d-86400*h-3600*c)/60),S=parseInt(d-86400*h-3600*c-60*m);const v=hwSheetDealPart.querySelectorAll(".sheet-deal-countdown-wrapper")[l];if(v){const A=v.querySelector(".sheet-deal-remaining.days .value"),_=v.querySelector(".sheet-deal-remaining.hours .value"),D=v.querySelector(".sheet-deal-remaining.mins .value"),L=v.querySelector(".sheet-deal-remaining.secs .value");A&&_&&D&&L&&(t(A,h),t(_,c),t(D,m),t(L,S)),timerInterval=setInterval(function(){S>1?(S--,t(L,S)):S==1?(S=0,t(L,S)):S==0&&(S=59,t(L,S),m>1?(m--,t(D,m)):m==1?(m=0,t(D,m)):m==0&&(m=59,t(D,m),c>1?(c--,t(_,c)):c==1?(c=0,t(_,c)):c==0&&(c=23,t(_,c),h>0&&(h--,t(_,h)))))},1e3)}}},t=(o,r)=>{o.innerHTML=n(r)},n=o=>o<10?"0"+o:o,s=(o,r)=>{const l=hwSheetDealPart.querySelectorAll("button.sheet-deal")[o];let u=/(<([^>]+)>)/gi;const d={title:r.title,text:`${r.reference} - ${r.description.replace(u,"")}`,url:r.url};l&&l.addEventListener("click",async()=>{try{await navigator.share(d)}catch(h){console.error(h)}})}}async function getSheetsByArea(e=1e4,t=12,n=null,s=""){let o={distanceMax:e,size:t,start:0,excludedIds:[globals.sheet_id],bordereaux:s,applyConfig:!0,appType:"website"};return n&&(o.confIds=[n]),(await postData("/content/ts/"+hwConfig.accountName+"/sheets/"+globals.sheet_id+"/nearest",o)).json()}const areaDOMBindingTag=document.getElementById("sheetPart-area");areaDOMBindingTag&&new IntersectionObserver((t,n)=>{t.forEach(s=>{if(s.isIntersecting){hide(areaDOMBindingTag);const o=areaDOMBindingTag.querySelectorAll(".tabs-panel");o.length>0&&o.forEach(r=>{const l=r.getAttribute("data-confid"),u=r.getAttribute("data-bordereaux");(l||u)&&getSheetsByArea(globals?.hawwwai?.sheet_options?.nearby_distance_max??1e4,12,l,u).then(d=>{if(d.data.length>0){const h=d.data;let c=[],m=[],S=[];h.forEach(_=>{_.idFiche&&(m.push(_.idFiche),S[`sheet_${_.idFiche}`]=_.distance)});const v=new URL(location.origin+"/wp-json/woody/api/sheets/nodes"),A=new URLSearchParams;A.append("sheets_ids",m.join(",")),A.append("lang",globals.current_locale),globals.current_season&&A.append("season",globals.current_season),v.search=A.toString(),fetch(v.toString()).then(_=>_.json()).then(_=>{_.forEach(w=>{if(w.post&&w.post.ID&&w.post.post_title){let M={id:w.post.ID,title:w.post.post_title,distance:S[`sheet_${w.sheetId}`]?S[`sheet_${w.sheetId}`]:0,aspect:!1};w.sourceIdentifier&&w.sourceIdentifier.includes("-")&&(M.aspect=w.sourceIdentifier.split("-")[0]),globals.sheet_current_aspect?M.aspect==globals.sheet_current_aspect&&c.push(M):(!M.aspect||M.aspect=="standard")&&c.push(M)}}),c.sort((w,M)=>w.distance-M.distance);let D="blocks-focus-tpl_352";c.length==1?D="blocks-focus-tpl_142":c.length==2?D="lists-list_grids-tpl_207":D="blocks-focus-tpl_352";let L=c.map(w=>w.id).join(",");if(L||l){let w;l?w="auto_focus_sheets":w="manual_focus";let Y=btoa('{"display_elements":["pretitle"]}');fetch(`/wp-json/woody/compile/focus?current_id=${globals.post_id}&layout=${w}&tpl_twig=${D}&post_ids=${L}&display=${Y}`).then(N=>N.json()).then(N=>{r.innerHTML=N,show(areaDOMBindingTag),c.forEach(I=>{let q=r.querySelector(`.card[data-postid='${I.id}']`);if(q!==null){const O=q.querySelector(".card-pretitle");if(O!==null)O.innerText=formatDistance(I.distance);else{const B=q.querySelector(".card-title");if(B!==null){let F=B.parentNode;if(F){let k=document.createElement("span");k.classList.add("card-pretitle"),k.classList.add("block-span"),k.innerText=formatDistance(I.distance),F.insertBefore(k,B)}}}}});const R=r.querySelector(".swiper-container:not(.woody_base_grid_wrapper)");if(R!==null){const I=R.parentElement;let q={loop:!1,centeredSlides:!1,keyboard:{enabled:!0},observer:!0,observeParents:!0,navigation:{addIcons:!1,prevEl:I!==null?I.querySelector(".swiper-button-prev"):null,nextEl:I!==null?I.querySelector(".swiper-button-next"):null}},O=R.getAttribute("data-options");O=O?JSON.parse(O):{};const B=Object.assign({},q,O);new window.Swiper(R,B)}}).catch(N=>{console.warn("Area block - Compile focus error : ",N)})}else{let w=r.id;if(w){let M=document.querySelector(`.tab-link[href="#${w}"]`);if(M!==null){M.parentElement.remove(),r.remove();const Y=new CustomEvent("sheetsAreaRemoveTabEvent",{detail:{areaDOMBindingTag}});document.dispatchEvent(Y)}}}})}else{let h=r.id;if(h){let c=document.querySelector(`.tab-link[href="#${h}"]`);if(c!==null){c.parentElement.remove(),r.remove();const m=new CustomEvent("sheetsAreaRemoveTabEvent",{detail:{areaDOMBindingTag}});document.dispatchEvent(m)}}}}).catch(d=>console.error(d))}),n.unobserve(s.target)}})},{threshold:0,rootMargin:"800px 0px"}).observe(areaDOMBindingTag),document.addEventListener("sheetsAreaRemoveTabEvent",e=>{if(e.detail&&e.detail.areaDOMBindingTag!==null){const t=e.detail.areaDOMBindingTag.querySelectorAll(".tabs-title");if(t.length==0)e.detail.areaDOMBindingTag.remove();else if(t.length==1){let n=t[0],s=e.detail.areaDOMBindingTag.querySelector(".woody-component-tabs .tabs-content");if(n!==null&&s!==null){n.click();let o=n.closest(".tabs-wrapper"),r=s.querySelector(".tabs-panel");if(o!==null&&r!==null){let l=document.createElement("h3");l.classList.add("sheet-part-subtitle"),l.classList.add("marg-bottom-sm"),l.innerText=n.querySelector(".tab-title").innerText,o.remove(),s.insertBefore(l,r)}}}else if(t.length>1){let n=t[0];if(n!==null){let s=n.querySelector("a").getAttribute("href");if(s){let o=n.closest(".woody-component-tabs").querySelector(`.tabs-content ${s}`);o!==null&&(o.classList.add("is-active"),n.classList.add("is-active"))}}}}});function formatDistance(e){const t=globals.current_locale,n={onSite:{de:"Vor Ort",en:"On site",es:"In situ",it:"In loco",ja:"\u73FE\u5730\u306B\u3066",jp:"\u73FE\u5730\u306B\u3066",nl:"Ter plaatse",default:"Sur place"},distance:{de:(r,l)=>l?`${r} Kilometer entfernt`:`${r} Meter entfernt`,en:(r,l)=>l?`${r} kilometers away`:`${r} meters away`,es:(r,l)=>l?`${r} kil\xF3metros de distancia`:`${r} metros de distancia`,it:(r,l)=>l?`${r} chilometri di distanza`:`${r} metri di distanza`,ja:(r,l)=>l?`${r} \u30AD\u30ED\u96E2\u308C\u305F\u3068\u3053\u308D`:`${r} \u30E1\u30FC\u30C8\u30EB\u96E2\u308C\u305F\u3068\u3053\u308D`,jp:(r,l)=>l?`${r} \u30AD\u30ED\u96E2\u308C\u305F\u3068\u3053\u308D`:`${r} \u30E1\u30FC\u30C8\u30EB\u96E2\u308C\u305F\u3068\u3053\u308D`,nl:(r,l)=>l?`${r} kilometer verderop`:`${r} meter verderop`,default:(r,l)=>l?`\xC0 ${r} km`:`\xC0 ${r} m`}};if(e===0)return n.onSite[t]||n.onSite.default;const s=e>=1e3,o=s?Math.round(e/1e3*10)/10:Math.ceil(e/10)*10;return n.distance[t]?n.distance[t](o,s):n.distance.default(o,s)}const sheetAspectsSelect=document.getElementById("sheet-aspects-select");sheetAspectsSelect!==null&&sheetAspectsSelect.addEventListener("change",e=>{const t=e.target.value;t&&(window.location.href=t)});const sheetEquipmentsBtn=document.querySelector(".equipments-button");sheetEquipmentsBtn!==null&&fakeClick(sheetEquipmentsBtn)})(jQuery,window,document);
